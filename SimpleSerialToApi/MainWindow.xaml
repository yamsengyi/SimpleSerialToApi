<Window x:Class="SimpleSerialToApi.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:SimpleSerialToApi"
        Title="Simple Serial To API" 
        Height="750" Width="900" 
        MinHeight="700" MinWidth="850"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
        <local:BoolToColorConverter x:Key="BoolToColorConverter"/>
    </Window.Resources>
    
    <DockPanel>
        <!-- 메뉴 바 -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="설정">
                <MenuItem Name="MenuStartupRegister" Header="윈도우 시작 프로그램 등록" Click="StartupRegister_Click"/>
                <MenuItem Name="MenuStartupUnregister" Header="윈도우 시작 프로그램 삭제" Click="StartupUnregister_Click"/>
                <Separator/>
                <MenuItem Header="트레이 설정" Click="TraySettings_Click"/>
                <Separator/>
                <MenuItem Header="종료" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="도구">
                <MenuItem Header="시작 프로그램 상태 확인" Click="CheckStartupStatus_Click"/>
                <MenuItem Header="레지스트리 열기" Click="OpenRegistry_Click"/>
            </MenuItem>
            <MenuItem Header="도움말">
                <MenuItem Header="정보" Click="About_Click"/>
            </MenuItem>
        </Menu>
        
        <!-- 메인 콘텐츠 -->
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

        <!-- Serial Port Configuration -->
        <GroupBox Grid.Row="0" Header="Serial Port" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <Label Grid.Column="0" Content="Port:" VerticalAlignment="Center"/>
                <ComboBox Grid.Column="1" 
                          ItemsSource="{Binding AvailablePorts}" 
                          SelectedValue="{Binding SerialPort}" 
                          SelectedValuePath="PortName"
                          DisplayMemberPath="DisplayName"
                          Margin="5,0" 
                          VerticalAlignment="Center"
                          MinWidth="200"/>
                <Button Grid.Column="2" 
                        Content="🔄" 
                        Command="{Binding RefreshPortsCommand}" 
                        Margin="5,0" 
                        Padding="8,5"
                        ToolTip="포트 목록 새로고침"
                        FontSize="14"/>
                <Button Grid.Column="3" 
                        Content="통신설정" 
                        Command="{Binding OpenSerialConfigCommand}" 
                        Margin="5,0" 
                        Padding="10,5"
                        ToolTip="통신 파라미터 설정 (Baudrate, Parity, Data bits 등)"/>
                <Button Grid.Column="4" Content="Connect" Command="{Binding ConnectCommand}" Margin="5,0" Padding="10,5"/>
                <Button Grid.Column="5" Content="Disconnect" Command="{Binding DisconnectCommand}" Margin="5,0" Padding="10,5"/>
            </Grid>
        </GroupBox>

        <!-- API Configuration -->
        <GroupBox Grid.Row="1" Header="API Settings" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <Label Grid.Column="0" Content="API URL:" VerticalAlignment="Center"/>
                <TextBox Grid.Column="1" Text="{Binding ApiUrl}" Margin="5,0" VerticalAlignment="Center"/>
                <Button Grid.Column="2" Content="Test" Command="{Binding TestApiCommand}" Margin="5,0" Padding="10,5"/>
            </Grid>
        </GroupBox>

        <!-- Status -->
        <GroupBox Grid.Row="2" Header="Status" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <Label Grid.Column="0" Content="Status:" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="1" Text="{Binding Status}" Margin="5,0" VerticalAlignment="Center"/>
            </Grid>
        </GroupBox>

        <!-- Device Identification -->
        <GroupBox Grid.Row="3" Header="Device Identification" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <Label Grid.Column="0" Content="Device ID:" VerticalAlignment="Center"/>
                <TextBox Grid.Column="1" Name="TxtDeviceId" Text="{Binding DeviceId, UpdateSourceTrigger=PropertyChanged}" 
                         Margin="5,0" VerticalAlignment="Center" Padding="5,2"
                         ToolTip="장비를 식별할 수 있는 고유 ID를 입력하세요"/>
                <Button Grid.Column="2" Content="설정" Command="{Binding SetDeviceIdCommand}" 
                        Margin="5,0" Padding="10,5"
                        ToolTip="Device ID를 저장합니다"/>
            </Grid>
        </GroupBox>

        <!-- Data Mapping Configuration (Button Only) -->
        <GroupBox Grid.Row="5" Header="Data Mapping and API Configuration" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal">
                <Button Content="데이터 매핑 및 API 설정" Command="{Binding OpenDataMappingCommand}" 
                        Padding="15,8" MinWidth="200" Background="LightBlue"
                        ToolTip="데이터 매핑 시나리오 및 API 설정을 관리합니다"/>
                <TextBlock Text="{Binding MappingScenariosCount, StringFormat='활성 시나리오: {0}개'}" 
                           VerticalAlignment="Center" Margin="20,0,0,0" Foreground="Gray" FontSize="12"/>
            </StackPanel>
        </GroupBox>

        <!-- Queue Management -->
        <GroupBox Grid.Row="6" Header="Queue Management" Margin="0,0,0,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- 첫 번째 행: 전송 간격 설정 -->
                <Grid Grid.Row="0" Margin="0,0,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <Label Grid.Column="0" Content="전송간격(초):" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="1" Name="TxtTransmissionInterval" Text="{Binding TransmissionInterval, UpdateSourceTrigger=PropertyChanged}" 
                             VerticalAlignment="Center" Margin="5,0" Padding="5,2"/>
                    <Button Grid.Column="2" Content="설정" Command="{Binding SetTransmissionIntervalCommand}" 
                            Margin="5,0" Padding="10,2"/>
                    
                    <Label Grid.Column="3" Content="동시전송량:" VerticalAlignment="Center" Margin="15,0,0,0"/>
                    <TextBox Grid.Column="4" Name="TxtBatchSize" Text="{Binding BatchSize, UpdateSourceTrigger=PropertyChanged}" 
                             VerticalAlignment="Center" Margin="5,0" Padding="5,2"/>
                    <Button Grid.Column="5" Content="설정" Command="{Binding SetBatchSizeCommand}" 
                            Margin="5,0" Padding="10,2"/>
                    
                    <Label Grid.Column="7" Content="현재 Queue:" VerticalAlignment="Center" Margin="15,0,0,0"/>
                    <TextBlock Grid.Column="8" Text="{Binding QueueCount}" Margin="5,0" VerticalAlignment="Center" 
                               FontWeight="Bold" FontSize="14"/>
                </Grid>
            </Grid>
        </GroupBox>

        <!-- Simulation Controls -->
        <GroupBox Grid.Row="7" Header="Simulation (Testing without hardware)" Margin="0,0,0,10">
            <StackPanel>
                <Grid Margin="0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <Label Grid.Column="0" Content="간격(초):" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="1" Text="{Binding SimulationInterval, UpdateSourceTrigger=PropertyChanged}" 
                             VerticalAlignment="Center" Margin="5,0" Padding="5,2"/>
                    <Button Grid.Column="2" Content="{Binding SimulationButtonText}" Command="{Binding StartSimulationCommand}" 
                            Margin="10,0,5,0" Padding="15,5" MinWidth="120"
                            Background="{Binding IsSimulating, Converter={StaticResource BoolToColorConverter}}"
                            ToolTip="시뮬레이션을 시작/중지합니다"/>
                    <Button Grid.Column="3" Content="단일 데이터 생성" Command="{Binding GenerateSingleDataCommand}" 
                            Margin="5,0" Padding="10,5" ToolTip="한 번만 시뮬레이션 데이터를 생성합니다"/>
                    <TextBlock Grid.Column="5" Text="시뮬레이션은 실제 장비 없이 테스트할 수 있도록 가상 데이터를 생성합니다" 
                               VerticalAlignment="Center" Margin="20,0,0,0" FontStyle="Italic" FontSize="11" Foreground="Gray"/>
                </Grid>
            </StackPanel>
        </GroupBox>
        
        <!-- Monitor Controls -->
        <GroupBox Grid.Row="8" Header="Monitoring" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal">
                <Button Content="Serial Monitor 열기" Command="{Binding OpenSerialMonitorCommand}" 
                        Margin="0,0,15,0" Padding="15,8" MinWidth="180" Background="LightGreen"
                        ToolTip="시리얼 통신 모니터 창을 엽니다"/>
                <Button Content="API Monitor 열기" Command="{Binding OpenApiMonitorCommand}" 
                        Margin="0,0,15,0" Padding="15,8" MinWidth="180" Background="LightCoral"
                        ToolTip="API 통신 모니터 창을 엽니다"/>
                <Button Content="🗑️ Queue 클리어" Command="{Binding ClearQueueCommand}" 
                        Margin="0,0,15,0" Padding="15,8" MinWidth="140" Background="Orange"
                        ToolTip="메시지 큐를 모두 삭제합니다"/>
                <Button Content="📋 로그 클리어" Command="{Binding ClearLogsCommand}" 
                        Margin="0,0,15,0" Padding="15,8" MinWidth="140" Background="LightYellow"
                        ToolTip="모든 모니터 로그를 삭제합니다"/>
                <TextBlock Text="{Binding SerialMonitorStatus}" VerticalAlignment="Center" 
                           Margin="20,0,10,0" Foreground="Gray" FontSize="11"/>
                <TextBlock Text="{Binding ApiMonitorStatus}" VerticalAlignment="Center" 
                           Foreground="Gray" FontSize="11"/>
            </StackPanel>
        </GroupBox>

        <!-- Footer -->
        <TextBlock Grid.Row="9" Text="Simple Serial To API - Ready" HorizontalAlignment="Center" 
                   Foreground="Gray" FontSize="10" Margin="0,10,0,0"/>
        </Grid>
    </DockPanel>
</Window>
