<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <!-- Configuration Sections -->
  <configSections>
    <section name="apiMappings" type="SimpleSerialToApi.Configuration.ApiMappingSection, SimpleSerialToApi" />
    <section name="messageQueue" type="SimpleSerialToApi.Configuration.MessageQueueSection, SimpleSerialToApi" />
    <section name="parsingRules" type="SimpleSerialToApi.Configuration.ParsingRulesSection, SimpleSerialToApi" />
  </configSections>
  
  <!-- Serial Communication Settings -->
  <appSettings>
    <add key="SerialPort" value="COM3" />
    <add key="BaudRate" value="9600" />
    <add key="Parity" value="None" />
    <add key="DataBits" value="8" />
    <add key="StopBits" value="One" />
    <add key="Handshake" value="None" />
    <add key="ReadTimeout" value="5000" />
    <add key="WriteTimeout" value="5000" />
    
    <!-- Legacy API Integration Settings (kept for backward compatibility) -->
    <add key="ApiEndpoint" value="https://api.example.com/data" />
    <add key="ApiMethod" value="POST" />
    <add key="AuthType" value="Bearer" />
    <add key="AuthToken" value="" />
    
    <!-- Legacy Message Queue Settings (kept for backward compatibility) -->
    <add key="QueueMaxSize" value="1000" />
    <add key="RetryMaxAttempts" value="3" />
    <add key="RetryDelayMs" value="1000" />
    
    <!-- HTTP Client Settings -->
    <add key="DefaultTimeout" value="30000" />
    <add key="MaxConcurrentRequests" value="10" />
    <add key="EnableCompression" value="true" />
    
    <!-- Retry Policy Settings -->
    <add key="DefaultRetryAttempts" value="3" />
    <add key="RetryDelayMs" value="1000" />
    <add key="UseExponentialBackoff" value="true" />
    
    <!-- Logging Settings -->
    <add key="LogLevel" value="Information" />
    <add key="LogToFile" value="true" />
    <add key="LogFilePath" value="logs/app_{Date}.log" />
    <add key="LogMaxFileSizeKB" value="10240" />
    <add key="LogRetainedFileCount" value="30" />
    <add key="LogToConsole" value="true" />
    <add key="LogToEventViewer" value="false" />
    <add key="LogStructuredFormat" value="true" />
    <add key="LogIncludeScopes" value="true" />
    
    <!-- Auto-Connect Settings -->
    <add key="AutoConnectEnabled" value="false" />
    <add key="AutoConnectPort" value="" />
    <add key="StartMinimized" value="false" />
    <add key="MinimizeToTray" value="false" />
    <add key="StartWithWindows" value="false" />
    
    <!-- Queue Processing Settings -->
    <add key="QueueTransmissionInterval" value="5" />
    <add key="QueueBatchSize" value="10" />
    
    <!-- Device Identification -->
    <add key="DeviceId" value="" />

    <!-- Data Mapping Settings -->
    <add key="EnableDataMapping" value="true" />
    <add key="MaxMappingScenarios" value="10" />

    <!-- Monitor Settings -->
    <add key="SerialMonitorEnabled" value="true" />
    <add key="ApiMonitorEnabled" value="true" />
    <add key="MonitorMaxLines" value="1000" />
    <add key="MonitorAutoScroll" value="true" />
  </appSettings>
  
  <!-- API Mapping Configuration -->
  <apiMappings>
    <endpoints>
      <add name="SensorDataEndpoint" 
           url="https://api.example.com/sensor-data" 
           method="POST" 
           authType="Bearer"
           authToken=""
           timeout="30000"
           retryAttempts="3"
           contentType="application/json" />
      <add name="StatusEndpoint" 
           url="https://api.example.com/device-status" 
           method="PUT" 
           authType="Bearer"
           authToken=""
           timeout="15000"
           retryAttempts="2"
           contentType="application/json" />
      <add name="AlertEndpoint"
           url="https://api.example.com/alerts"
           method="POST"
           authType="ApiKey"
           authToken=""
           timeout="10000"
           retryAttempts="3"
           contentType="application/json" />
    </endpoints>
    <mappingRules>
      <add sourceField="temperature" 
           targetField="temp_celsius" 
           dataType="decimal" 
           converter="TemperatureConverter"
           defaultValue="0.0"
           isRequired="true" />
      <add sourceField="humidity" 
           targetField="humidity_percent" 
           dataType="decimal" 
           converter=""
           defaultValue="0.0"
           isRequired="false" />
      <add sourceField="deviceId" 
           targetField="device_identifier" 
           dataType="string" 
           converter=""
           defaultValue=""
           isRequired="true" />
    </mappingRules>
  </apiMappings>
  
  <!-- Message Queue Configuration -->
  <messageQueue>
    <queues>
      <add name="ApiDataQueue"
           maxSize="1000"
           batchSize="10"
           batchTimeout="5000"
           retryCount="3"
           retryInterval="5000"
           enablePriority="true" />
      <add name="LogQueue"
           maxSize="500"
           batchSize="20"
           batchTimeout="10000"
           retryCount="1"
           retryInterval="1000"
           enablePriority="false" />
    </queues>
    <processors>
      <add queueName="ApiDataQueue"
           processorType="SimpleSerialToApi.Services.Queues.ApiDataQueueProcessor"
           threadCount="2"
           enableAsync="true" />
    </processors>
  </messageQueue>
  
  <!-- Data Parsing Rules Configuration -->
  <parsingRules>
    <rules>
      <add name="TemperatureSensor"
           pattern="TEMP:([0-9.]+)C;HUMID:([0-9.]+)%"
           fields="temperature,humidity"
           dataTypes="decimal,decimal"
           dataFormat="TEXT"
           priority="1" />
      <add name="PressureSensor"
           pattern="PRESS:([0-9.]+)hPa"
           fields="pressure"
           dataTypes="decimal"
           dataFormat="TEXT"
           priority="1" />
      <add name="JsonSensor"
           pattern="temperature,humidity,pressure"
           fields="temp,humid,press"
           dataTypes="decimal,decimal,decimal"
           dataFormat="JSON"
           priority="2" />
      <add name="HexTemperature"
           pattern="0:2,2:2"
           fields="temperature,humidity"
           dataTypes="int,int"
           dataFormat="HEX"
           priority="1" />
    </rules>
    <converters>
      <add name="TemperatureConverter"
           sourceUnit="celsius"
           targetUnit="fahrenheit"
           formula="(x * 9/5) + 32" />
      <add name="PressureConverter"
           sourceUnit="hPa"
           targetUnit="psi"
           formula="x * 0.0145038" />
    </converters>
  </parsingRules>
  
  <!-- Comprehensive Logging Configuration -->
  <logging>
    <logLevel>
      <add name="Default" minLevel="Information" />
      <add name="SimpleSerialToApi.Services.SerialCommunicationService" minLevel="Debug" />
      <add name="SimpleSerialToApi.Services.HttpApiClientService" minLevel="Information" />
      <add name="SimpleSerialToApi.Services.Queues" minLevel="Debug" />
      <add name="SimpleSerialToApi.Services.ErrorHandling" minLevel="Information" />
      <add name="SimpleSerialToApi.Services.Recovery" minLevel="Information" />
      <add name="SimpleSerialToApi.Services.Monitoring" minLevel="Information" />
      <add name="Microsoft" minLevel="Warning" />
      <add name="System" minLevel="Warning" />
    </logLevel>
    <providers>
      <add name="File"
           enabled="true"
           path="logs/app_{Date}.log"
           maxFileSizeKB="10240"
           retainedFileCountLimit="30"
           outputTemplate="[{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz}] [{Level:u3}] [{SourceContext}] {Message:lj}{NewLine}{Exception}"
           rollingInterval="Day" />
      <add name="Console"
           enabled="true"
           includeScopes="true"
           outputTemplate="[{Timestamp:HH:mm:ss.fff}] [{Level:u3}] {Message:lj}{NewLine}{Exception}" />
      <add name="EventViewer"
           enabled="false"
           logName="Application"
           sourceName="SimpleSerialToApi"
           minLevel="Warning" />
      <add name="Debug"
           enabled="true"
           minLevel="Debug" />
    </providers>
    <enrichers>
      <add name="MachineName" />
      <add name="Environment" />
      <add name="ProcessId" />
      <add name="ThreadId" />
    </enrichers>
  </logging>
  
  <!-- Error Handling Configuration -->
  <errorHandling>
    <globalHandler enabled="true" />
    <recoveryStrategies>
      <add name="SerialConnection" maxAttempts="5" enabled="true" />
      <add name="ApiConnection" maxAttempts="3" enabled="true" />
      <add name="QueueOperation" maxAttempts="2" enabled="true" />
    </recoveryStrategies>
    <notifications>
      <add level="Error" showToUser="true" logToFile="true" />
      <add level="Warning" showToUser="false" logToFile="true" />
      <add level="Critical" showToUser="true" logToFile="true" generateReport="true" />
    </notifications>
  </errorHandling>
  
  <!-- Health Monitoring Configuration -->
  <healthMonitoring>
    <enabled>true</enabled>
    <checkInterval>00:00:30</checkInterval>
    <components>
      <add name="SerialCommunication" enabled="true" interval="00:00:30" />
      <add name="ApiCommunication" enabled="true" interval="00:01:00" />
      <add name="MessageQueue" enabled="true" interval="00:00:15" />
      <add name="SystemResources" enabled="true" interval="00:02:00" />
    </components>
    <thresholds>
      <add component="SystemResources" metric="MemoryUsageMB" warning="250" critical="500" />
      <add component="SystemResources" metric="CpuUsagePercent" warning="50" critical="80" />
      <add component="MessageQueue" metric="QueueUtilization" warning="0.7" critical="0.9" />
    </thresholds>
  </healthMonitoring>
  
  <!-- API Configuration Section -->
  <apiConfiguration>
    <endpoints>
      <add name="SensorDataEndpoint"
           url="https://api.example.com/sensor-data"
           method="POST"
           authType="Bearer"
           authToken="encrypted_token_here"
           timeout="30000"
           retryAttempts="3"
           contentType="application/json" />
      <add name="DeviceStatusEndpoint"
           url="https://api.example.com/device-status"
           method="PUT"
           authType="ApiKey"
           authToken="your_api_key_here"
           timeout="25000"
           retryAttempts="2"
           contentType="application/json" />
      <add name="AlertEndpoint"
           url="https://api.example.com/alerts"
           method="POST"
           authType="BasicAuth"
           authToken="username:password"
           timeout="15000"
           retryAttempts="3"
           contentType="application/json" />
    </endpoints>
    <httpClient>
      <add key="DefaultTimeout" value="30000" />
      <add key="MaxConcurrentRequests" value="10" />
      <add key="EnableCompression" value="true" />
      <add key="UserAgent" value="SimpleSerialToApi/1.0" />
    </httpClient>
    <retry>
      <add key="DefaultRetryAttempts" value="3" />
      <add key="RetryDelayMs" value="1000" />
      <add key="UseExponentialBackoff" value="true" />
      <add key="MaxDelayMs" value="30000" />
      <add key="BackoffMultiplier" value="2.0" />
    </retry>
    <authentication>
      <add key="TokenCacheExpiryMinutes" value="60" />
      <add key="RefreshTokenThresholdMinutes" value="5" />
      <add key="EnableAuthenticationCache" value="true" />
    </authentication>
  </apiConfiguration>
</configuration>